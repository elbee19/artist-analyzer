$.extend({
    createElement: function(el, props) {
        var $el = $(document.createElement(el));
        $el.attr(props);
        return $el;
    }
});

// hide main image
$("#smileysPicture").slideUp();
$("#resultsList").html("");

// show loading
//TODO: too much repetition here, add method
loaderElem = $.createElement('div', {'class':'spinner','id':'loader'});

loaderSubElem1 = $.createElement('div',{'class':'spinner-container container1'});
loaderSubElem2 = $.createElement('div',{'class':'spinner-container container2'});
loaderSubElem3 = $.createElement('div',{'class':'spinner-container container3'});
loaderSubElem1.append($.createElement('div', {'class':'circle1'}));
loaderSubElem1.append($.createElement('div', {'class':'circle2'}));
loaderSubElem1.append($.createElement('div', {'class':'circle3'}));
loaderSubElem1.append($.createElement('div', {'class':'circle4'}));
loaderSubElem2.append($.createElement('div', {'class':'circle1'}));
loaderSubElem2.append($.createElement('div', {'class':'circle2'}));
loaderSubElem2.append($.createElement('div', {'class':'circle3'}));
loaderSubElem2.append($.createElement('div', {'class':'circle4'}));
loaderSubElem3.append($.createElement('div', {'class':'circle1'}));
loaderSubElem3.append($.createElement('div', {'class':'circle2'}));
loaderSubElem3.append($.createElement('div', {'class':'circle3'}));
loaderSubElem3.append($.createElement('div', {'class':'circle4'}));
loaderElem.append(loaderSubElem1);
loaderElem.append(loaderSubElem2);
loaderElem.append(loaderSubElem3);
$("#resultsBox").append(loaderElem);

// get list of all song ids from variable
song_ids = <%= @song_ids %>;

// for each song id, get the song info and append the result
$.each(song_ids, function(key,value)
{
	$.ajax({
		url: '/song/'+value,
		type: 'GET',
		success: function(data) {
			resultElement = createResultElement(data);
			$('#resultsList').append(resultElement);
		}
	});
});


$(document).ajaxStop(function () {
    $("#loader").remove();
});

function createResultElement(data)
{
	resultElem = $('<%= j render(:partial => "result", :locals => {:data => "data"})%>');
	
	if(data.sentiment == 1)
	{
		resultElem.find("#negativeImage").remove();
	}
	else
	{
		resultElem.find("#positiveImage").remove();
	}

	resultElem.find("#songTitle").html(data.title);

	if(data.media!=null)
	{

		remSoundCloud = true;
		remYouTube = true;
		$.each(data.media, function(key,val){
			//alert(val.media_provider+" "+val.media_url);
			if(val.media_provider == "youtube")
			{
				remYouTube = false;
				resultElem.find("#youTubeLink").attr("href",val.media_url);
			}

			if(val.media_provider == "soundcloud")
			{
				remSoundCloud = false;
				resultElem.find("#soundCloudLink").attr("href",val.media_url);
			}
		});

		if(remYouTube)
		{
			resultElem.find("#youTubeLink").remove();
		}
		if(remSoundCloud)
		{
			resultElem.find("#soundCloudLink").remove();
		}
	}

	resultElem.find("#geniusLink").attr("href",data.genius_url);

	//handle escape chars
	desc = data.description.replace(/(?:\r\n|\r|\n)/g, '<br />');
	resultElem.find("#songDescription").html(desc);

	return resultElem;
}
